/* eslint-env node */
import { truncate } from "@/lib/utils"
import { ImageResponse } from "@vercel/og"
import { NextRequest } from "next/server"

export const runtime = "edge"

export async function GET(req: NextRequest) {
  try {
    const { searchParams } = new URL(req.url)

    const title = searchParams.get("title") || "Help Center"
    const summary =
      searchParams.get("summary") || "Learn more about our platform"

    return new ImageResponse(
      (
        <div
          style={{
            height: "100%",
            width: "100%",
            display: "flex",
            flexDirection: "column",
            backgroundColor: "rgb(44, 40, 37)",
            backgroundImage:
              "linear-gradient(rgba(243, 241, 239, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(243, 241, 239, 0.1) 1px, transparent 1px)",
            backgroundSize: "40px 40px",
            color: "rgb(243, 241, 239)",
            padding: "48px 60px",
          }}
        >
          {/* Logo container */}
          <div style={{ display: "flex", flexGrow: 0, marginBottom: "20px" }}>
            <svg
              width="240"
              height="80"
              viewBox="0 0 675 225"
              fill="rgb(243, 241, 239)"
              style={{ opacity: 0.9 }}
            >
              <path d="M40.326 51.562H73.03c11.094 0 19.707 2.617 25.844 7.844 6.145 5.218 9.219 12.82 9.219 22.797 0 10.074-3.074 17.793-9.219 23.156-6.137 5.355-14.75 8.031-25.844 8.031H59.717v35.203h-19.39Zm31.594 44.36c11 0 16.5-4.524 16.5-13.579 0-4.531-1.414-7.906-4.234-10.125C81.373 70 77.283 68.89 71.92 68.89H59.717v27.031ZM115.03 76.515h18.155v13.719c1.29-5.258 3.805-9.227 7.547-11.906 3.75-2.688 8.672-3.844 14.766-3.47v17.595h-2.625c-5.555 0-10.133 1.734-13.734 5.203-3.606 3.468-5.407 8.156-5.407 14.062v36.875H115.03ZM197.364 150.39c-7.305 0-13.868-1.683-19.688-5.047-5.824-3.375-10.402-7.945-13.734-13.719-3.324-5.78-4.985-12.093-4.985-18.937 0-6.832 1.66-13.16 4.985-18.984 3.332-5.82 7.91-10.414 13.734-13.782 5.82-3.375 12.383-5.062 19.688-5.062 7.289 0 13.847 1.687 19.672 5.062 5.82 3.368 10.394 7.961 13.718 13.782 3.332 5.824 5 12.152 5 18.984 0 6.844-1.668 13.156-5 18.937-3.324 5.774-7.898 10.344-13.718 13.72-5.825 3.363-12.383 5.046-19.672 5.046Zm-19.688-37.703c0 3.793.805 7.262 2.422 10.406 1.613 3.137 3.922 5.633 6.922 7.485 3.008 1.843 6.457 2.765 10.344 2.765 3.875 0 7.312-.922 10.312-2.765 3.008-1.852 5.32-4.348 6.938-7.485 1.613-3.144 2.422-6.613 2.422-10.406 0-3.781-.836-7.242-2.5-10.39-1.657-3.145-3.965-5.66-6.922-7.548-2.961-1.894-6.375-2.843-10.25-2.843-3.887 0-7.309.949-10.266 2.843-2.96 1.887-5.273 4.403-6.937 7.547-1.657 3.149-2.485 6.61-2.485 10.391ZM244.07 76.515h18.437v11.64c2.125-4.25 4.988-7.503 8.594-9.765 3.601-2.27 8.406-3.406 14.406-3.406 6.469 0 12.426 1.715 17.875 5.14 5.457 3.418 9.781 8.016 12.969 13.797 3.187 5.774 4.78 12.075 4.78 18.907 0 6.843-1.593 13.132-4.78 18.859-3.188 5.73-7.512 10.281-12.97 13.656-5.448 3.364-11.405 5.047-17.874 5.047-5.824 0-10.559-1.086-14.203-3.25-3.649-2.176-6.492-5.25-8.531-9.219v38.391h-18.704Zm18.156 36.313c0 3.793.828 7.261 2.484 10.406 1.664 3.137 4.047 5.633 7.14 7.484 3.102 1.844 6.641 2.766 10.61 2.766 3.883 0 7.328-.945 10.328-2.844 3-1.894 5.352-4.437 7.063-7.625 1.718-3.187 2.578-6.629 2.578-10.328 0-3.781-.836-7.242-2.5-10.39-1.668-3.145-4.028-5.66-7.078-7.548-3.043-1.894-6.508-2.843-10.391-2.843-3.969 0-7.508.949-10.61 2.843-3.093 1.887-5.476 4.43-7.14 7.625-1.656 3.188-2.484 6.672-2.484 10.454ZM362.293 150.39c-6.469 0-12.43-1.683-17.875-5.047-5.45-3.375-9.773-7.926-12.969-13.656-3.187-5.727-4.78-12.016-4.78-18.86 0-6.831 1.593-13.132 4.78-18.906 3.196-5.78 7.52-10.379 12.97-13.797 5.444-3.425 11.405-5.14 17.874-5.14 5.914 0 10.676 1.09 14.281 3.265 3.602 2.168 6.422 5.29 8.454 9.36V47.406h18.718v101.187H385.59v-11.781c-2.125 4.344-5.016 7.695-8.672 10.047-3.648 2.351-8.523 3.531-14.625 3.531Zm-16.906-37.703c0 3.7.851 7.14 2.562 10.328 1.707 3.188 4.063 5.73 7.063 7.625 3.008 1.899 6.453 2.844 10.328 2.844 3.977 0 7.516-.922 10.61-2.766 3.093-1.851 5.472-4.347 7.14-7.484 1.664-3.145 2.5-6.613 2.5-10.406 0-3.782-.836-7.266-2.5-10.454-1.668-3.195-4.047-5.738-7.14-7.625-3.094-1.894-6.633-2.843-10.61-2.843-3.875 0-7.34.949-10.39 2.843-3.055 1.887-5.415 4.403-7.079 7.547-1.656 3.149-2.484 6.61-2.484 10.391ZM450.454 150.39c-7.304 0-13.867-1.683-19.687-5.047-5.824-3.375-10.402-7.945-13.734-13.719-3.325-5.78-4.985-12.093-4.985-18.937 0-6.832 1.66-13.16 4.985-18.984 3.332-5.82 7.91-10.414 13.734-13.782 5.82-3.375 12.383-5.062 19.687-5.062 7.29 0 13.848 1.687 19.672 5.062 5.82 3.368 10.395 7.961 13.719 13.782 3.332 5.824 5 12.152 5 18.984 0 6.844-1.668 13.156-5 18.937-3.324 5.774-7.898 10.344-13.719 13.72-5.824 3.363-12.383 5.046-19.672 5.046Zm-19.687-37.703c0 3.793.805 7.262 2.422 10.406 1.613 3.137 3.922 5.633 6.922 7.485 3.007 1.843 6.457 2.765 10.343 2.765 3.875 0 7.313-.922 10.313-2.765 3.008-1.852 5.32-4.348 6.937-7.485 1.614-3.144 2.422-6.613 2.422-10.406 0-3.781-.836-7.242-2.5-10.39-1.656-3.145-3.965-5.66-6.922-7.548-2.96-1.894-6.375-2.843-10.25-2.843-3.886 0-7.308.949-10.265 2.843-2.961 1.887-5.274 4.403-6.938 7.547-1.656 3.149-2.484 6.61-2.484 10.391ZM531.535 150.39c-6.75 0-12.969-1.683-18.656-5.047-5.68-3.375-10.184-7.972-13.516-13.797-3.324-5.82-4.984-12.148-4.984-18.984 0-6.938 1.66-13.29 4.984-19.063 3.332-5.78 7.957-10.351 13.875-13.718 5.914-3.375 12.52-5.063 19.813-5.063 6.383 0 12.113 1.18 17.187 3.531 5.082 2.356 9.149 5.657 12.203 9.907L548.02 99.937c-1.656-2.488-3.828-4.473-6.515-5.953-2.68-1.477-5.586-2.219-8.719-2.219-3.887 0-7.308.95-10.266 2.844-2.96 1.898-5.273 4.418-6.937 7.562-1.656 3.137-2.484 6.602-2.484 10.391 0 3.687.851 7.125 2.562 10.312 1.707 3.188 4.086 5.73 7.14 7.625 3.052 1.899 6.516 2.844 10.391 2.844 3.426 0 6.383-.738 8.875-2.219 2.5-1.476 4.766-3.601 6.797-6.375l13.578 11.782c-7.21 9.242-17.511 13.86-30.906 13.86ZM588.492 114.359v34.234h-18.703V47.406h18.703v58.218l27.031-29.109h26.625l-33.969 33.547 34.094 38.531H617.46Zm0 0" />
            </svg>
          </div>

          {/* Content container */}
          <div
            style={{
              display: "flex",
              flexDirection: "column",
              alignItems: "center",
              justifyContent: "flex-start",
              flexGrow: 1,
              textAlign: "center",
              gap: "20px",
              paddingTop: "40px",
            }}
          >
            {/* Badge */}
            <div
              style={{
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                backgroundColor: "rgba(243, 241, 239, 0.1)",
                padding: "8px 16px",
                borderRadius: "9999px",
                marginBottom: "4px",
              }}
            >
              <span
                style={{
                  fontSize: "20px",
                  fontFamily: "SF Pro",
                  fontWeight: 500,
                  letterSpacing: "0.01em",
                }}
              >
                Kunnskapsbase
              </span>
            </div>

            <h1
              style={{
                fontSize: 72,
                fontFamily: "SF Pro",
                margin: 0,
                lineHeight: 1.1,
                fontWeight: 700,
                maxWidth: "900px",
                letterSpacing: "-0.02em",
              }}
            >
              {truncate(title, 100)}
            </h1>
            <p
              style={{
                margin: 0,
                fontSize: 32,
                fontFamily: "SF Pro",
                opacity: 0.8,
                maxWidth: "700px",
                lineHeight: 1.4,
              }}
            >
              {truncate(summary, 140)}
            </p>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
      },
    )
  } catch (e: any) {
    console.error(`Failed to generate OG image: ${e.message}`)
    return new Response(`Failed to generate OG image: ${e.message}`, {
      status: 500,
    })
  }
}
